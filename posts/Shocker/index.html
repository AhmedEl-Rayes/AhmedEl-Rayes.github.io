<!DOCTYPE html><html lang="en" data-mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Shocker" /><meta property="og:locale" content="en" /><meta name="description" content="Shocker is a fun easy level linux machine on HacktheBox which features the shellshock exploit to get a foothold on the box, and from there we escalate privileges by abusing sudo privileges in perl." /><meta property="og:description" content="Shocker is a fun easy level linux machine on HacktheBox which features the shellshock exploit to get a foothold on the box, and from there we escalate privileges by abusing sudo privileges in perl." /><link rel="canonical" href="https://ahmedel-rayes.github.io/posts/Shocker/" /><meta property="og:url" content="https://ahmedel-rayes.github.io/posts/Shocker/" /><meta property="og:site_name" content="Anubis-Sec" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2023-01-17T08:47:00-06:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Shocker" /><meta name="twitter:site" content="@twitter_username" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2023-01-17T12:46:34-06:00","datePublished":"2023-01-17T08:47:00-06:00","description":"Shocker is a fun easy level linux machine on HacktheBox which features the shellshock exploit to get a foothold on the box, and from there we escalate privileges by abusing sudo privileges in perl.","headline":"Shocker","mainEntityOfPage":{"@type":"WebPage","@id":"https://ahmedel-rayes.github.io/posts/Shocker/"},"url":"https://ahmedel-rayes.github.io/posts/Shocker/"}</script><title>Shocker | Anubis-Sec</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Anubis-Sec"><meta name="application-name" content="Anubis-Sec"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="/assets/img/anubis.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Anubis-Sec</a></div><div class="site-subtitle font-italic">“Ask, and it shall be given you; seek, and ye shall find; knock, and it shall be opened unto you”</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/AhmedEl-Rayes" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['aelrayes00','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="https://www.linkedin.com/in/ahmedelrayes00/" aria-label="linkedin" target="_blank" rel="noopener"> <i class="fab fa-linkedin"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Shocker</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>Shocker</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1673966820" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Jan 17, 2023 </em> </span> <span> Updated <em class="" data-ts="1673981194" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Jan 17, 2023 </em> </span><div class="d-flex justify-content-between"> <span> By <em> <a href="https://github.com/AhmedEl-Rayes">Ahmed El-Rayes</a> </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="449 words"> <em>2 min</em> read</span></div></div></div><div class="post-content"><p>Shocker is a fun easy level linux machine on HacktheBox which features the shellshock exploit to get a foothold on the box, and from there we escalate privileges by abusing sudo privileges in perl.</p><h3 id="enumeration"><span class="mr-2">Enumeration</span><a href="#enumeration" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Nmap shows us-</p><p><img data-src="/assets/img/shocker/nmap.png" alt="nmap" data-proofer-ignore></p><p>With only HTTP and SSH to look at, let’s begin with enumerating the website.</p><p><img data-src="/assets/img/shocker/gobuster.png" alt="gobuster" data-proofer-ignore></p><p>The website is just a static HTML page, we can find hidden web directories using gobuster. It’s important to note that only the directory with the trailing slash is valid</p><p><img data-src="/assets/img/shocker/notfound.png" alt="notfound" data-proofer-ignore></p><p>With the trailing slash this time we get a 403 forbidden</p><p><img data-src="/assets/img/shocker/perm.png" alt="perm" data-proofer-ignore></p><p>CGI stands for “Common Gateway Interface”, and is esentially a folder in apache that houses scripts. The client sends a request to the server, the web server recieves the request and passes it to the CGI program, then the program executes and passes the output back to the web server, and the web server passes something back to the client. Common extensions for these scripts are .pl, .sh, .cgi, .py, and so on. If we use gobuster like this: <code class="language-plaintext highlighter-rouge">/usr/bin/gobuster dir -u http://10.10.10.56/cgi-bin/ -w /usr/share/wordlists/dirb/small.txt -x sh,cgi,pl</code> we can look for any potential scripts in the /cgi-bin/ directory with those file extensions.</p><p><img data-src="/assets/img/shocker/user.png" alt="user" data-proofer-ignore></p><p>We see that user.sh exists on the server. Visiting the /cgi-bin/user.sh filepath downloads a text file for us, which is just the output of the <code class="language-plaintext highlighter-rouge">uptime</code> command.</p><p><img data-src="/assets/img/shocker/uptime.png" alt="uptime" data-proofer-ignore></p><p>Googling around about CGI-bins, we learn that it is often vulnerable to the shellshock vulnerability if the version of bash is old enough. The reason this exploit works with CGI is because the web server is passing user supplied data into the shell script as environment variables, stuff like user agent, cookies, or other GET parameters. By inserting the shell shock payload followed by a command into one of these variables, we can get RCE on the box. Let’s try it with this one-liner I found on github. <img data-src="/assets/img/shocker/shock.png" alt="shock" data-proofer-ignore></p><p>We can see that by putting the shell shock payload into the ‘user-agent’ field, we can execute commands. We’ll send this over to burp and play around with it more.</p><p><img data-src="/assets/img/shocker/notwork.png" alt="notwork" data-proofer-ignore></p><p>When we remove the <code class="language-plaintext highlighter-rouge">echo; echo;</code> line, the command doesn’t work.</p><p><img data-src="/assets/img/shocker/works.png" alt="works" data-proofer-ignore></p><p>Putting 1 echo back makes it work again.</p><p><img data-src="/assets/img/shocker/notworks2.png" alt="notworks2" data-proofer-ignore></p><p>It also won’t work if we don’t specify the full path of the command, or use /bin/bash -c ‘command’ as shown earlier</p><p><img data-src="/assets/img/shocker/works2.png" alt="works2" data-proofer-ignore></p><h3 id="foothold"><span class="mr-2">Foothold</span><a href="#foothold" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Anyways, let’s get a reverse shell. Set up a listener and throw a reverse shell one liner for bash at the server.</p><p><img data-src="/assets/img/shocker/payload.png" alt="payload" data-proofer-ignore></p><p>We get a reverse shell as Shelly. Checking our sudo priveleges on the box gives us:</p><p><img data-src="/assets/img/shocker/privs.png" alt="privs" data-proofer-ignore></p><p>We have access to run perl as root, meaning we are 1 quick search on GTFO bins away from root.</p><p><img data-src="/assets/img/shocker/perl.png" alt="perl" data-proofer-ignore></p><p>Using the first one gives us a root shell.</p><p><img data-src="/assets/img/shocker/privesc.png" alt="privest" data-proofer-ignore></p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/htb/'>htb</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/linux/" class="post-tag no-text-decoration" >Linux</a> <a href="/tags/outdated-software/" class="post-tag no-text-decoration" >Outdated Software</a> <a href="/tags/shell-shock/" class="post-tag no-text-decoration" >Shell Shock</a> <a href="/tags/path-injection/" class="post-tag no-text-decoration" >Path Injection</a> <a href="/tags/rce/" class="post-tag no-text-decoration" >RCE</a> <a href="/tags/cgi-bin/" class="post-tag no-text-decoration" >cgi-bin</a> <a href="/tags/perl/" class="post-tag no-text-decoration" >perl</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Shocker+-+Anubis-Sec&url=https%3A%2F%2Fahmedel-rayes.github.io%2Fposts%2FShocker%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Shocker+-+Anubis-Sec&u=https%3A%2F%2Fahmedel-rayes.github.io%2Fposts%2FShocker%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fahmedel-rayes.github.io%2Fposts%2FShocker%2F&text=Shocker+-+Anubis-Sec" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/CPTS/">Certified Penetration Testing Specialist Notes</a><li><a href="/posts/CRTP/">Certified Red Team Professional Notes</a><li><a href="/posts/PortSwigger/">Port Swigger Academy Notes</a><li><a href="/posts/PNPT/">PNPT Notes</a><li><a href="/posts/ConsoleCowboy/">The Way of the Console Cowboy</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/linux/">Linux</a> <a class="post-tag" href="/tags/windows/">Windows</a> <a class="post-tag" href="/tags/outdated-software/">Outdated Software</a> <a class="post-tag" href="/tags/password-cracking/">Password Cracking</a> <a class="post-tag" href="/tags/hash-capture/">Hash Capture</a> <a class="post-tag" href="/tags/public-vulnerabilities/">Public Vulnerabilities</a> <a class="post-tag" href="/tags/weak-credentials/">Weak Credentials</a> <a class="post-tag" href="/tags/active-directory/">Active Directory</a> <a class="post-tag" href="/tags/anonymous-access/">Anonymous Access</a> <a class="post-tag" href="/tags/educational/">Educational</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/Nibbles/"><div class="card-body"> <em class="small" data-ts="1675888020" data-df="ll" > Feb 8, 2023 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Nibbles</h3><div class="text-muted small"><p> Nibbles is an easy level Linux machine on HacktheBox. We start by getting a foothold by guessing user credentials for a blog site, and finding out we can upload and execute arbitrary PHP files. Usi...</p></div></div></a></div><div class="card"> <a href="/posts/ConsoleCowboy/"><div class="card-body"> <em class="small" data-ts="1673368200" data-df="ll" > Jan 10, 2023 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>The Way of the Console Cowboy</h3><div class="text-muted small"><p> Tips and Tricks for Navigating Linux tmux Tmux is a powerful screen multiplexer, meaning it lets you handle multiple panes in a command line interface, which is super useful for sys-admin tasks, ...</p></div></div></a></div><div class="card"> <a href="/posts/CPTS/"><div class="card-body"> <em class="small" data-ts="1680279120" data-df="ll" > Mar 31, 2023 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Certified Penetration Testing Specialist Notes</h3><div class="text-muted small"><p> Network Enumeration with Nmap Nmap is one of the most used tools by network admins and IT security specialists, it can be used to Audit the security aspects of networks, simulate penetration tests...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/Bastion/" class="btn btn-outline-primary" prompt="Older"><p>Bastion</p></a> <a href="/posts/Active/" class="btn btn-outline-primary" prompt="Newer"><p>Active</p></a></div></div></div><footer class="row pl-3 pr-3"><div class="col-12 d-flex justify-content-between align-items-center text-muted pl-0 pr-0"><div class="footer-left"><p class="mb-0"> © 2023 <a href="https://github.com/AhmedEl-Rayes">Ahmed El-Rayes</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/linux/">Linux</a> <a class="post-tag" href="/tags/windows/">Windows</a> <a class="post-tag" href="/tags/outdated-software/">Outdated Software</a> <a class="post-tag" href="/tags/password-cracking/">Password Cracking</a> <a class="post-tag" href="/tags/hash-capture/">Hash Capture</a> <a class="post-tag" href="/tags/public-vulnerabilities/">Public Vulnerabilities</a> <a class="post-tag" href="/tags/weak-credentials/">Weak Credentials</a> <a class="post-tag" href="/tags/active-directory/">Active Directory</a> <a class="post-tag" href="/tags/anonymous-access/">Anonymous Access</a> <a class="post-tag" href="/tags/educational/">Educational</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a><div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-animation="true" data-autohide="false"><div class="toast-header"> <button type="button" class="ml-2 ml-auto close" data-dismiss="toast" aria-label="Close"> <span aria-hidden="true">&times;</span> </button></div><div class="toast-body text-center pt-0"><p class="pl-2 pr-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></div><script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script>
